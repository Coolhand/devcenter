
<p>One of the most popular open source projects that users deploy to their OpenShift gears is WordPress.  However, if you use the standard quickstart or instant app template, you will notice that by default WordPress is not scalable on the OpenShift PaaS.  The main reason for this is the way the application stores media and plugins on the filesystem.  In a scaled environment, you can't be guaranteed that you have shared file storage on all gears.  In this post, I will explain and demonstrate how to create a scaleable WordPress deployment where your media files on hosted on Amazon S3.</p>

<h2 id="signing-up-for-an-openshift-account"><strong>Signing up for an OpenShift Account</strong></h2>

<p>If you donâ€™t already have an OpenShift account, head on over to the website and signup. It is completely free and Red Hat gives every user three free Gears on which to run your applications. At the time of this writing, the combined resources allocated for each user is 1.5 GB of memory and 3 GB of disk space.</p>

<h2 id="install-the-client-tools-on-your-machine"><strong>Install the client tools on your machine</strong></h2>

<p>The OpenShift client tools are written in a very popular programming language called Ruby. With OSX 10.6 or later and most Linux distributions, ruby is installed by default so installing the client tools is a snap. Simply issue the following command on your terminal application:</p>

<pre><code>sudo gem install rhc
</code></pre>

<h2 id="setting-up-openshift"><strong>Setting up OpenShift</strong></h2>

<p>In order to configure the OpenShift command line tools, all you need to do is enter in the following command:</p>

<pre><code>rhc setup
</code></pre>

<h2 id="creating-the-wordpress-instance"><strong>Creating the Wordpress instance</strong></h2>

<p>Create a scalable application on the OpenShift system to house your WordPress deployment.  Once you have signed up for an account, all you need to do is issue the following command:</p>

<pre><code>$ rhc app create wordpress php-5.3 -s
</code></pre>

<p>The <em>-s</em> options informs OpenShift that you want to create your application with a scalable infrastructure.  Essentially this means that your application gear will be fronted with a HAProxy load balancer and your MySQL database will be hosted on a separate gear from your first application gear.  If you want more detailed information on how scaling works, check out this excellent [post[(https://www.openshift.com/blogs/scaling-in-action-on-openshift).</p>

<h2 id="adding-mysql"><strong>Adding MySQL</strong></h2>

<p>As you know, Wordpress requires the use of the MySQL database.  Fortunately, it is a simply process to add a database to your <em>wordpress</em> application that you created in the previous step.  To add database support for your installation, enter the following command:</p>

<pre><code>$ rhc cartridge add mysql-5.1 -a wordpress
</code></pre>

<p>After this command has been executed, the admin username and password will be displayed on the terminal.  Make a quick note of these in case you need them in the future.  If you fail to remember these, or make a note of them, you always view them again be using the following command:</p>

<pre><code>$ rhc app show wordpress
</code></pre>

<h2 id="downloading-the-wordpress-code"><strong>Downloading the WordPress code</strong></h2>

<p>The OpenShift team maintains a quickstart that makes installing Wordpress extremely easy.  All it takes is a few commands:</p>

<p><strong>Note:</strong> Execute the following command from inside of your git repository that was cloned to your local machine after creating the wordpress application:</p>

<pre><code>$ git remote add upstream -m master git://github.com/openshift/wordpress-example.git
$ git pull -s recursive -X theirs upstream master
</code></pre>

<h2 id="creating-your-themes-and-plugins-directories"><strong>Creating your <em>themes</em> and <em>plugins</em> directories</strong></h2>

<p>The quickstart source code that we just downloaded assumes that the user does not want to create a scaled Wordpress instance.  Because of this, the code creates a symlink for the <em>themes</em> and <em>plugins</em> directories and links back to your <em>data</em> directory.  Unfortunately, when a scale event happens, the data directory is not synced to your new application gear once it has been spun up and added to your WordPress cluster.  To fix this, we simply need to create these directories.  Change to your <em>wordpress/php/wp-content</em> directory enter the following command:</p>

<pre><code>$ mkdir plugins
$ mkdir themes
</code></pre>

<h2 id="deploy-your-wordpress-instance"><strong>Deploy your Wordpress instance</strong></h2>

<p>At this point, we have a scaled infrastructure created, a MySQL database installed and configured, and the Wordpress source code in our local git repository.  All we need to do at this point is to deploy our instance up to the OpenShift cloud:</p>

<pre><code>$ git add .
$ git commit -am "My first deploy"
$ git push
</code></pre>

<h2 id="managing-themes-and-plugins"><strong>Managing themes and plugins</strong></h2>

<p>In order to correctly sync your themes and plugins over to new nodes as they are created, you can not use the WordPress UI to install these items.  This is because when you use the Wordpress UI to install new items, it stores them on the filesystem on your first OpenShift gear.  When a new gear is created, the service syncs your code over from your git repository so this is where you need to perform the installation of new themes and plugins.</p>

<p>To install a theme or plugin, simply download the .zip file for the item and extract the contents in the proper directory on your local machine,  For example, to install a new theme you would save the file to the <em>wordpress/php/wp-content/themes</em> directory and execute the following commands:</p>

<pre><code>$ unzip themeName.zip
$ rm themName.zip
$ git add .
$ git commit -am "Adding new theme"
$ git push
</code></pre>

<p>Once the push completes, you can log in to your WordPress instance and activate the theme.  The process is the same for plugins.</p>

<h2 id="what-about-scaling-my-media"><strong>What about scaling my media?</strong></h2>

<p>Be default, when you upload images and other media to WordPress, the system stores the data on the local filesystem.  This is problematic for the same reason we previously discussed around themes and plugins.  Fortunately, there are several plugins that you can install that will save your media uploads to a cloud based storage system.  For this blog post, I am storing all of the images on Amazon S3 to ensure that my media can scale just as well as my Wordpress instance.  I am using a plugin called <a href="https://github.com/bradt/wp-tantan-s3">Amazon S3 and Cloud Front</a>.</p>

<h2 id="backups"><strong>Backups?</strong></h2>

<p>I am paranoid when it comes to backing up my software.  I decided to go with another great plugin called [Updraft[(http://wordpress.org/plugins/updraftplus/) to will backup my blog on a daily basis to my dropbox account.</p>

<h2 id="does-it-really-scale"><strong>Does it really scale?</strong></h2>

<p><strong>YES!</strong>  I ran a load test against my blog and finally shut the test down after I scaled up to 10 servers.  The site was fast and responsive even under heavy load and all content and media were served correctly.</p>

<p>Have fun and happy scaling!</p>

<h2 id="whats-next">What's Next?</h2>

<ul>
  <li><a href="https://www.openshift.com/app/account/new">Sign up for OpenShift Online</a></li>
  <li>Get your own <a href="https://engage.redhat.com/forms/contact-sales-openshift">private Platform As a Service</a> (PaaS) 
by evaluating <a href="https://www.openshift.com/products/enterprise/try-enterprise">OpenShift Enterprise</a></li>
  <li>Need Help? <a href="https://www.openshift.com/forums/openshift">Ask the OpenShift Community</a> your questions in the forums</li>
  <li>Showcase your awesome app in the <a href="https://www.openshift.com/developer-spotlight">OpenShift Developer Spotlight</a>. 
Get in the <a href="https://www.openshift.com/application-gallery">OpenShift Application Gallery</a> today.</li>
</ul>
